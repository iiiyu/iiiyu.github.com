<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content="iOS Cocoa OSX 如果不能成为拯救世界的神 那就堕落到征服世界的魔吧 产品 产品原型 产品设计"/><title>iOS笔记(20) | 萧宸宇</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iOS笔记(20)</h1><a id="logo" href="/">萧宸宇</a><p class="description">如果不能成为拯救世界的神，那就堕落到征服世界的魔吧。</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about-me/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">iOS笔记(20)</h1><div class="post-meta">2013 Apr 15日 | </div><span data-disqus-identifier="2013/04/15/learning-ios-notes-twenty/" class="disqus-comment-count"></span><div class="post-content"><h1 id="UITableView_u7B80_u5355_u89E3_u6790"><a href="#UITableView_u7B80_u5355_u89E3_u6790" class="headerlink" title="UITableView简单解析"></a>UITableView简单解析</h1><h2 id="u5E8F"><a href="#u5E8F" class="headerlink" title="序"></a>序</h2><p>UITableView是在iOS开发中，展示大量内容的首选。我个人认为的原有有一下几点：</p>
<ol>
<li>UITableView的展现形式是为移动设备专门设计过的。有较好的人机交互体验。</li>
<li>从技术角度来说UITableView具有重用和延迟加载等特性。如果使用恰当。可以获得一个App流畅的用户体验。</li>
</ol>
<p>这样，使得UITableView在iOS App中随处可见。</p>
<p>原生应用</p>
<p><img src="http://ww4.sinaimg.cn/large/a74ecc4cjw1e3q5jk1wrtj.jpg" alt=""></p>
<p>一些有名的App.图片信息较老</p>
<p><img src="http://ww4.sinaimg.cn/large/a74eed94jw1e3q5kl91luj.jpg" alt=""></p>
<p>包括游戏</p>
<p><img src="http://ww1.sinaimg.cn/large/a74e55b4jw1e3q5lb59vwj.jpg" alt=""></p>
<p>这些都说明UITableView在一个App中其实是一个很常用的控件。我应该好好的学习它。</p>
<a id="more"></a>
<h2 id="u5173_u4E8E_u6570_u636E_u7684_u601D_u8003"><a href="#u5173_u4E8E_u6570_u636E_u7684_u601D_u8003" class="headerlink" title="关于数据的思考"></a>关于数据的思考</h2><h3 id="u6CA1_u6709UITableView_u7684_u65F6_u5019_u6211_u662F_u8FD9_u6837_u60F3_u7684"><a href="#u6CA1_u6709UITableView_u7684_u65F6_u5019_u6211_u662F_u8FD9_u6837_u60F3_u7684" class="headerlink" title="没有UITableView的时候我是这样想的"></a>没有UITableView的时候我是这样想的</h3><p>首先思考为什么会有UITableView这样的控件。我们做一个App的时候，就会有大量的数据需要显示。比如weibo的每一个状态。比如一个新闻App的很多条新闻。这些数据都会有一个特点就是他们的组织形式一样，只是内容变化。有时候我们可能会根据一些条件进行分组。使得看来了是分组的。例如：联系人里面会按照首字母来进行分组一样。我们还可能会点击数据以便查看更详细的内容。通过上面的简单描述，如果来自己实现一个类似UITableView的结构。需要得到最核心的：</p>
<ol>
<li>需要得到一共多少条数据</li>
<li>数据的具体内容是什么</li>
</ol>
<p>如果我们数据需要更加仔细的描述展示：</p>
<ol>
<li>全部的数据一共有多少组</li>
<li>每一组有多少个数据</li>
<li>每一条数据的具体内容是什么</li>
</ol>
<h3 id="UITableView_u662F_u600E_u4E48_u505A_u7684"><a href="#UITableView_u662F_u600E_u4E48_u505A_u7684" class="headerlink" title="UITableView是怎么做的"></a>UITableView是怎么做的</h3><p>在UITableView中。最重要的就是data source中的两个方法。</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="pp">- <span class="params">(<span class="variable">NSInteger</span>)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView numberOfRowsInSection:<span class="params">(<span class="variable">NSInteger</span>)</span>section;</span><br><span class="line"></span><br><span class="line">- <span class="params">(<span class="variable">UITableViewCell</span> *)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView cellForRowAtIndexPath:<span class="params">(<span class="variable">NSIndexPath</span> *)</span>indexPath;</span></span><br></pre></td></tr></table></figure>
<p>什么是data source。字面意思就是很明白，数据的来源。一般情况下我们会设置拥有UITableView的这个UIViewController为他的data source。因为根据MVC来说。UITableView是View，UIViewController是Controller。View需要的数据，应该是Controller去跟Model协调然后获得，以后由Controller去给View来进行显示。View永远的不去直接跟Model联系。这样当UITableView初始化的时候。他就会去问他的data source。我需要显示多少行数据啊。每一行的数据都是什么内容啊。这时候UIViewController应该已经从Model拿到了数据。然后通过- (NSInteger)tableView:(UITableView <em>)tableView numberOfRowsInSection:(NSInteger)section;告诉UITableview，恩你的这一组要显示n条数据。又用- (UITableViewCell </em>)tableView:(UITableView <em>)tableView cellForRowAtIndexPath:(NSIndexPath </em>)indexPath函数告诉UITableView说，第几组第几条数据的具体内容是什么。</p>
<p>UITableView还有一个比较犀利的地方就是如果你的数据有10000条。它肯定不是把10000条都加载进来。而是只加载需要显示的条目数据。这样设计，使得UITableView的流畅程度大大提高。值得注意的是，如果Cell里面的数据是从网络 or Core Data等其他地方读取的。我们应该把读取动作写成异步的。不阻塞主线程。取到数据以后在回答主线程去刷新UI。</p>
<p>UITableView从创建到显示的调用顺序如下图</p>
<p><img src="http://ww4.sinaimg.cn/large/a74ecc4cjw1e3sfatxy0gj.jpg" alt=""></p>
<ul>
<li>(NSInteger)numberOfSectionsInTableView:(UITableView *)tableView这个函数是最先调用，但是它默认返回1.所以并不是必须的。如果你的UITableView分了好几组，这个就是用来返回组的数量的。</li>
</ul>
<p>这样完成了设置UITableView的data source设置。在完成</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="pp">- <span class="params">(<span class="variable">NSInteger</span>)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView numberOfRowsInSection:<span class="params">(<span class="variable">NSInteger</span>)</span>section;</span><br><span class="line"></span><br><span class="line">- <span class="params">(<span class="variable">UITableViewCell</span> *)</span>tableView:<span class="params">(<span class="variable">UITableView</span> *)</span>tableView cellForRowAtIndexPath:<span class="params">(<span class="variable">NSIndexPath</span> *)</span>indexPath;</span></span><br></pre></td></tr></table></figure>
<p>这两个函数。我们就可以得到一个能显示的UITableView了。</p>
<p>现在是是仅仅解释了UITableView的数据是怎么来的，然后怎么对应到UITableView上面。</p>
<h2 id="UITableViewCell"><a href="#UITableViewCell" class="headerlink" title="UITableViewCell"></a>UITableViewCell</h2><p>UITableViewCell具体的每一条数据展示的具体View。首先在UITableView里面有这样一个特点，每一个Cell的大概样子都长的差不多，只是里面具体的内容稍有变化。这样在UI里面我们应该是重用相同的部分，改变不同的部分。这样才能提高效率。因为在UiTableView这个视图里面，用户习惯性快速的滚动，视图和数据内容都会快速的变化，如果效率问题处理不好，很容易有卡顿的现象。造成用户体验的降低。</p>
<p>如果使用默认的UITableViewCell风格，有以下四种</p>
<p>UITableViewCellStyleDefault</p>
<p><img src="http://ww2.sinaimg.cn/large/a74eed94jw1e3sha1cl2oj.jpg" alt=""></p>
<p>UITableViewCellStyleSubtile</p>
<p><img src="http://ww4.sinaimg.cn/large/a74e55b4jw1e3shcdevpbj.jpg" alt=""></p>
<p>UITableViewCellStyleValue1</p>
<p><img src="http://ww1.sinaimg.cn/large/bfadf3bejw1e3shcssq55j.jpg" alt=""></p>
<p>UITableViewCellStyleValue2</p>
<p><img src="http://ww4.sinaimg.cn/large/a74ecc4cjw1e3shdbgbrgj.jpg" alt=""></p>
<p>当然如果是需要自定义Cell也是很简单。 用xib拖一个，完全可以GUI的方式来创建，很是方便。</p>
<p>(Google一个栗子吧，写不动了)</p>
<p>插一句，Cell的重用是需要下面这样的实现方法</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSString</span> *Cell = <span class="string">@"MyCell"</span>;</span><br><span class="line">    <span class="built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:Cell];</span><br><span class="line">    <span class="keyword">if</span> (!cell) &#123;</span><br><span class="line">        cell = [[<span class="built_in">UITableViewCell</span> alloc] initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:Cell];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重要的是UITableView的dequeueReusableCellWithIdentifier方法。</p>
<p>dequeueReusableCellWithIdentifier去一个队列里面需找有没有相同ID的的Cell。如果有就提出来重用。可以重用的部分。如果没有就跳进if里面去创建。所以我们在if里面创建的时候，不会改变的内容都可以在里面创建，这样就只用创建一次。需要改变的内容我们就放到if后面去写。 这样我们就能完成高效的UITableView。当然，理论上来说，你可以不用这样的机制，而去直接每次创建一个Cell。不过这是非常浪费资源的一个做法，直接不提倡。</p>
<h2 id="UITableView_Delegate"><a href="#UITableView_Delegate" class="headerlink" title="UITableView Delegate"></a>UITableView Delegate</h2><p>当然，在写UITableView肯定想控制的更多。才能完成设计师们辛辛苦苦画出来的稿。这样我们可以去看看Data source里面剩下的函数和Delegate。</p>
<p>当然就说一点</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//选中Cell响应事件</span></span><br><span class="line"><span class="tag">-</span> (void)<span class="tag">tableView</span>:(UITableView *)<span class="tag">tableView</span> <span class="tag">didSelectRowAtIndexPath</span>:(NSIndexPath *)<span class="tag">indexPath</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//选中后的反显颜色即刻消失</span></span><br><span class="line">    <span class="attr_selector">[tableView deselectRowAtIndexPath:indexPath animated:YES]</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个是选中Cell时候会的出发点。如果要点击以后做什么事情 就在这里做了。 </p>
<p><a href="http://www.devdiv.com/home.php?mod=space&amp;uid=39974&amp;do=blog&amp;id=2573" target="_blank" rel="external">找了篇目测还ok的中文blog可以先看看了解</a></p>
<h2 id="u6570_u636E_u5237_u65B0"><a href="#u6570_u636E_u5237_u65B0" class="headerlink" title="数据刷新"></a>数据刷新</h2><p>如果我们的modle更新了。相应的要体现到UITableView上面。简单的我们可以reload整个TableView。这样做很方便，而且数据上没有问题。唯一的问题就是，reload整个TableView的效率太低了。而且，往往我们只是少数的Cell内容变化。所以没有必要去reload整个TableView。而是那条数据变化去刷新对应的Cell就好了。这样做效率提高很多。</p>
<p>具体涉及到的几个函数</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="pp">- <span class="params">(void)</span>beginUpdates;</span><br><span class="line">- <span class="params">(void)</span>endUpdates;</span><br><span class="line"> </span><br><span class="line">- <span class="params">(void)</span>insertSections:<span class="params">(<span class="variable">NSIndexSet</span> *)</span>sections withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;</span><br><span class="line">- <span class="params">(void)</span>deleteSections:<span class="params">(<span class="variable">NSIndexSet</span> *)</span>sections withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;</span><br><span class="line">- <span class="params">(void)</span>reloadSections:<span class="params">(<span class="variable">NSIndexSet</span> *)</span>sections withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;</span><br><span class="line"> </span><br><span class="line">- <span class="params">(void)</span>insertRowsAtIndexPaths:<span class="params">(<span class="variable">NSArray</span> *)</span>indexPaths withRowAnimation: <span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;</span><br><span class="line">- <span class="params">(void)</span>deleteRowsAtIndexPaths:<span class="params">(<span class="variable">NSArray</span> *)</span>indexPaths withRowAnimation: <span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;</span><br><span class="line">- <span class="params">(void)</span>reloadRowsAtIndexPaths:<span class="params">(<span class="variable">NSArray</span> *)</span>indexPaths withRowAnimation:<span class="params">(<span class="variable">UITableViewRowAnimation</span>)</span>animation;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.cnblogs.com/smileEvday/archive/2012/06/28/tableView.html" target="_blank" rel="external">这里有实例代码可以参考</a></p>
<p><a href="http://developer.apple.com/library/ios/#documentation/UserExperience/Conceptual/TableView_iPhone/ManageInsertDeleteRow/ManageInsertDeleteRow.html#//apple_ref/doc/uid/TP40007451-CH10-SW1" target="_blank" rel="external">官方教程</a></p>
<p>里面写了如何优化UITableView：</p>
<p><a href="http://www.keakon.net/2011/08/03/优化UITableView性能" target="_blank" rel="external">又找了一篇blog写的很不错的样子，优化UITableView性能</a></p>
<h2 id="u540E_u8BB0"><a href="#u540E_u8BB0" class="headerlink" title="后记"></a>后记</h2><p>总结就是UITableView是一个高度设计的控件。它具有重用，分组，异步加载数据等方面需要我们注意。</p>
<p>其实这里插进来写UITableView是为了写NSFetchedResultsController。因为NSFetchedResultsController就是为UITableview量身打造的Core Data的类。 </p>
<p>所以，先说明以下UITableView，然后再写NSFetchedResultsController。</p>
</div><div class="tags"><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a href="/2013/04/17/learning-ios-notes-twenty-one/" class="pre"><i class="icon-previous">iOS笔记(21) CoreData (三) NSFetchedResultsController</i></a><a href="/2013/04/01/learning-ios-notes-nineteen/" class="next">iOS笔记(19)<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'iyunsn';
var disqus_identifier = '2013/04/15/learning-ios-notes-twenty/';
var disqus_title = 'iOS笔记(20)';
var disqus_url = 'http://iiiyu.com/2013/04/15/learning-ios-notes-twenty/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//iyunsn.disqus.com/count.js" async="async"></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><input placeholder="Search" type="text" class="st-default-search-input"/></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/just-talk/" style="font-size: 15px;">just-talk</a> <a href="/tags/Software/" style="font-size: 15px;">Software</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/read-book-notes/" style="font-size: 15px;">read book notes</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Design/" style="font-size: 15px;">Design</a> <a href="/tags/Emacs/" style="font-size: 15px;">Emacs</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/01/31/read-the-tipping-point/">读书笔记 「引爆点」</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/20/2014-oh-my-star-app-annual-summary/">2014年 Oh My Star 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/16/read-contagious/">读书笔记 「疯传」</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/26/learning-ios-notes-thirty-six/">iOS 学习笔记 (36)  ReactiveCocoa 用 RACSignal 替代 Delegate</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/20/iCloud-and-iCloud-Drive/">iCloud 和 iCloud Drive</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/04/23/learn-ui-design-two/">怎样使用Sketch 3切图 —— 从想入设计大门的菜逼进化到切图仔（未完成）</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/04/08/learning-ios-notes-thirty-five/">iOS笔记(35) 格志周年系列之夏令时(三) 临时花絮</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/25/learn-ui-design-one/">学习UI设计笔记(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/19/learning-ios-notes-thirty-four/">iOS笔记(34) 格志周年系列之夏令时(二)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/18/learning-ios-notes-thirty-three/">iOS笔记(33) 格志周年系列之夏令时(一)</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//iyunsn.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://www.ohmystarapp.com/" title="Oh My Star" target="_blank">Oh My Star</a><ul></ul><a href="http://griddiaryapp.com" title="Grid Diary" target="_blank">Grid Diary</a></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">萧宸宇.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','Nm83mrKyygUM42socQtA','2.0.0');
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-29764460-1','auto');ga('send','pageview');
</script></div></body></html>