<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description" content="iOS Cocoa OSX 如果不能成为拯救世界的神 那就堕落到征服世界的魔吧 产品 产品原型 产品设计"/><title>sizeof 深入理解 | 萧宸宇</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">sizeof 深入理解</h1><a id="logo" href="/">萧宸宇</a><p class="description">如果不能成为拯救世界的神，那就堕落到征服世界的魔吧。</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about-me/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">sizeof 深入理解</h1><div class="post-meta">2012 Feb 9日 | </div><span data-disqus-identifier="2012/02/09/what-is-sizeof/" class="disqus-comment-count"></span><div class="post-content"><h1 id="sizeof__u6DF1_u5165_u7406_u89E3"><a href="#sizeof__u6DF1_u5165_u7406_u89E3" class="headerlink" title="sizeof 深入理解"></a>sizeof 深入理解</h1><p>sizeof你们觉得是什么呢。函数？其实是操作符。<br>wiki解释</p>
<blockquote>
<p>In the programming languages C and C++, the unary operator ‘sizeof’ is used to calculate the sizes of datatypes, in number of bytes. sizeof can be applied to all datatypes, be they primitive types such as the integer and floating-point types defined in the language, pointers to memory addresses, or the compound datatypes (unions, structs, or C++ classes) defined by the programmer. sizeof is an operator that returns the size in bytes of the type of the variable or parenthesized type-specifier that it precedes as a size_t type value.</p>
</blockquote>
<p>sizeof is an operator：sizeof是一个操作符。擦 这货居然是操作符。<br>最后一句我们可以得到的信息还有sizeof操作符的结果类型是size_t，它在头文件中typedef为unsigned　int类型。该类型保证能容纳实现所建立的最大对象的字节大小。</p>
<a id="more"></a>
<p>我们先记住什么时候可能用到sizeof,因为我们毕竟是学了用的.sizeof的应用场景一般是神马呢：</p>
<ul>
<li>sizeof操作符的一个主要用途是与存储分配和I/O系统那样的例程进行通信。例如：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>　*<span class="title">malloc</span><span class="params">(size_t　size)</span></span><br><span class="line">size_t　<span class="title">fread</span><span class="params">(<span class="keyword">void</span>　*　ptr,size_t　size,size_t　nmemb,FILE　*　stream)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>用它可以看看一类型的对象在内存中所占的单元字节。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void　*　memset(void　*　s,int　c,sizeof(s))</span><br></pre></td></tr></table></figure>
<ul>
<li>在动态分配一对象时,可以让系统知道要分配多少内存。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> * pointer = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>便于一些类型的扩充,在windows中就有很多结构内型就有一个专用的字段是用来放该类型的字节大小。</p>
</li>
<li><p>由于操作数的字节数在实现时可能出现变化，建议在涉及到操作数字节大小时用sizeof来代替常量计算。</p>
</li>
<li><p>如果操作数是函数中的数组形参或函数类型的形参，sizeof给出其指针的大小。</p>
</li>
</ul>
<p>知道怎么用以后我们来深入的蛋疼的讨论一下吧：<br>那我们考虑一下它既然是操作符那是一元的呢还是一元的呢还是一元的呢。。。。。。。。。。。。。</p>
<p>网上有人说sizeof是一元操作符，网上还有人说sizeof更像一个特殊的宏，它是在编译阶段求值的。<br>举个例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(a=3):%d\n"</span>,<span class="keyword">sizeof</span>(a = <span class="number">3</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a:%d\n"</span>,a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出为什么是4，0而不是期望中的4，3？？？就在于sizeof在编译阶段处理的特性。由于sizeof不能被编译成机器码，所以sizeof作用范围内，也就是()里面的内容也不能被编译，而是被替换成类型。=操作符返回左操作数的类型，所以a=3相当于int，而代码也被替换为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"sizeof(a=3):%d\n"</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"a:%d\n"</span>,a);</span><br></pre></td></tr></table></figure>
<p>所以，sizeof是不可能支持链式表达式的，这也是和一元操作符不一样的地方。<br>结论：好，记住：sizeof 在 计算变量所占空间大小时， 括号可以省略， 而计算类型(模子)大小时不能省略。 一般情况下， 咱也别偷这个懒， 乖乖的写上括号， 继续装作一个 “函数” 做一个 ， “披着函数皮的操作符” 。 做我的操作符，让人家认为是函数去吧。 不要把sizeof当成函数，也不要看作一元操作符，把他当成一个特殊的编译预处理。</p>
<p>其实说到这里也差不多了，最后看一下几个比较飘逸的例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sizeof</span>（<span class="keyword">int</span>）*p 表示什么意思？</span><br><span class="line"><span class="keyword">int</span> *p = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">sizeof</span>(p)的值是多少？</span><br><span class="line"><span class="keyword">sizeof</span>(*p)呢？</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">100</span>];</span><br><span class="line"><span class="keyword">sizeof</span> (a) 的值是多少？</span><br><span class="line"><span class="keyword">sizeof</span>(a[<span class="number">100</span>])呢？<span class="comment">//请尤其注意本例。</span></span><br><span class="line"><span class="keyword">sizeof</span>(&amp;a)呢？</span><br><span class="line"><span class="keyword">sizeof</span>(&amp;a[<span class="number">0</span>])呢？</span><br><span class="line"><span class="keyword">int</span> b[<span class="number">100</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> b[<span class="number">100</span>])</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="keyword">sizeof</span>(b);<span class="comment">// sizeof (b) 的值是多少？</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>时间不早了  1点多了 明天还要上班  睡了  结果自己看吧。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#inlcude &lt;stdio.h&gt; </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> b[<span class="number">100</span>])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"fun()sizeof(b):%d\n"</span>,<span class="keyword">sizeof</span>(b));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> b[<span class="number">100</span>]; </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(p):%d\n"</span>,<span class="keyword">sizeof</span>(p));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(*p):%d\n"</span>,<span class="keyword">sizeof</span>(*p));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(a):%d\n"</span>,<span class="keyword">sizeof</span>(a));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(a[100]):%d\n"</span>,<span class="keyword">sizeof</span>(a[<span class="number">100</span>]));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(&amp;a):%d\n"</span>,<span class="keyword">sizeof</span>(&amp;a));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(&amp;a[0]):%d\n"</span>,<span class="keyword">sizeof</span>(&amp;a[<span class="number">0</span>]));</span><br><span class="line">    fun(a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/just-talk/">just-talk</a></div><div class="post-nav"><a href="/2012/02/09/junior-it-people-c-study-guide/" class="pre"><i class="icon-previous">IT人士入门指南</i></a><a href="/2012/02/07/how-to-install-octopress-on-heroku/" class="next">怎样搭建一个Octopress<i class="icon-next"></i></a></div><div id="disqus_thread"><script>var disqus_shortname = 'iiiyu';
var disqus_identifier = '2012/02/09/what-is-sizeof/';
var disqus_title = 'sizeof 深入理解';
var disqus_url = 'http://iiiyu.com/2012/02/09/what-is-sizeof/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//iiiyu.disqus.com/count.js" async="async"></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><input placeholder="Search" type="text" class="st-default-search-input"/></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/just-talk/" style="font-size: 15px;">just-talk</a> <a href="/tags/Software/" style="font-size: 15px;">Software</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/read-book-notes/" style="font-size: 15px;">read book notes</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Design/" style="font-size: 15px;">Design</a> <a href="/tags/Emacs/" style="font-size: 15px;">Emacs</a> <a href="/tags/随便瞎扯/" style="font-size: 15px;">随便瞎扯</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/12/2016-IT-professionals-Getting-Started/">2016年移动互联网职业入门规划指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/31/read-the-tipping-point/">读书笔记 「引爆点」</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/20/2014-oh-my-star-app-annual-summary/">2014年 Oh My Star 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/16/read-contagious/">读书笔记 「疯传」</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/26/learning-ios-notes-thirty-six/">iOS 学习笔记 (36)  ReactiveCocoa 用 RACSignal 替代 Delegate</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/20/iCloud-and-iCloud-Drive/">iCloud 和 iCloud Drive</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/04/23/learn-ui-design-two/">怎样使用Sketch 3切图 —— 从想入设计大门的菜逼进化到切图仔（未完成）</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/04/08/learning-ios-notes-thirty-five/">iOS笔记(35) 格志周年系列之夏令时(三) 临时花絮</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/25/learn-ui-design-one/">学习UI设计笔记(一)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/03/19/learning-ios-notes-thirty-four/">iOS笔记(34) 格志周年系列之夏令时(二)</a></li></ul></div><div class="widget"><div class="widget-title">最近评论</div><script type="text/javascript" src="//iiiyu.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://www.ohmystarapp.com/" title="Oh My Star" target="_blank">Oh My Star</a><ul></ul><a href="http://griddiaryapp.com" title="Grid Diary" target="_blank">Grid Diary</a></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">萧宸宇.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','Nm83mrKyygUM42socQtA','2.0.0');
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-29764460-1','auto');ga('send','pageview');
</script></div></body></html>