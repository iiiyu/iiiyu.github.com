<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="iOS Cocoa OSX 如果不能成为拯救世界的神 那就堕落到征服世界的魔吧 产品 产品原型 产品设计"><title>CoreData VS Realm （2016-02-23更新） | 萧宸宇</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-29764460-1','auto');ga('send','pageview');</script></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CoreData VS Realm （2016-02-23更新）</h1><a id="logo" href="/.">萧宸宇</a><p class="description">如果不能成为拯救世界的神，那就堕落到征服世界的魔吧。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about-me/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CoreData VS Realm （2016-02-23更新）</h1><div class="post-meta">Jan 19, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a data-disqus-identifier="2016/01/19/CoreData-VS-Realm/" href="/2016/01/19/CoreData-VS-Realm/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>本文具有强烈的个人感情色彩,如有观看不适,请尽快关闭. 本文仅作为个人学习记录使用,也欢迎在<a href="http://creativecommons.org/licenses/by-nc/4.0/deed.zh_TW" target="_blank" rel="external">许可协议</a>范围内转载或使用,请尊重版权并且保留原文链接,谢谢您的理解合作. 如果您觉得本站对您能有帮助,您可以使用<a href="http://iiiyu.com/atom.xml">RSS</a>方式订阅本站,这样您将能在第一时间获取本站信息.</p>
<h2 id="碎碎念"><a href="#碎碎念" class="headerlink" title="碎碎念"></a>碎碎念</h2><p>OhMyStar 2 也进行了一段时日，我把持久化的方式从CoreData 换到了 Realm。有些感悟，顺手就记录一下吧。以下评论都是自己很主观的感受，无实际测试数据支持。</p>
<h2 id="论-iOS-的持久化"><a href="#论-iOS-的持久化" class="headerlink" title="论 iOS 的持久化"></a>论 iOS 的持久化</h2><p>iOS 持久化其实也没多少选择， 高端一点CoreData、Realm、FMDB、KV类(LevelDB等)。低端一些直接一个 NSArray 就写成 Plist 也能持久化下来。</p>
<p>在网络环境越来越快的当下和大部分应用数据都可能是网络应用，如果业务逻辑并不复杂，其实极端一点就只用写到 JSON 转 Object 就好了。而且一堆这样好用的封装，远有<a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a> 近有<a href="https://github.com/ibireme/YYModel" target="_blank" rel="external">YYModel</a>。</p>
<p>所以需要持久化的时候，我觉的可以慎重的评估一下需求。想明白了，后面可以节省很多事情。</p>
<p>本文章主要对比 Realm 和 CoreData，其他的就不涉及了。</p>
<a id="more"></a>
<h2 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><h4 id="入门门槛低"><a href="#入门门槛低" class="headerlink" title="入门门槛低"></a>入门门槛低</h4><p><a href="https://realm.io/docs/swift/latest/" target="_blank" rel="external">Realm文档</a>就算一个字一个字扣着读完，一个下午就足够了。而且还有中文版本，不要太友好哦，有点不习惯诶。</p>
<p>文档覆盖了80%的使用情况，甚至有些太简陋的嫌疑。但不管怎么样，这种入门条件比起 CoreData 写了三个月都没搞清楚 Context 要好的多。</p>
<p>在库的工具链上，安装一个 Realm Browser 以后就不需要其他辅助了。还是简单。</p>
<p>几乎做到了上手即用的程度。五星好评。</p>
<p>PS：我用了一个通宵把 OhMyStar 2 的持久化从 CoreData 换到了 Realm ，优化调整了大概5天左右达到勉强可以用的情况 。在这之前并没有任何 Realm 的经验。</p>
<h4 id="据说性能好一些"><a href="#据说性能好一些" class="headerlink" title="据说性能好一些"></a>据说性能好一些</h4><p><a href="https://realm.io/news/introducing-realm/" target="_blank" rel="external">Realm官方介绍Fast一段中</a></p>
<p>Counts<br><img src="https://realm.io/assets/benchmarks/benchmarks.002b.png" alt="Counts"></p>
<p>Queries<br><img src="https://realm.io/assets/benchmarks/benchmarks.003b.png" alt="Queries"></p>
<p>Inserts<br><img src="https://realm.io/assets/benchmarks/benchmarks.001b.png" alt="Inserts"></p>
<p>在写这里的时候我顺手Google了一下 发现一篇<a href="http://suree.org/2015/09/29/DatabaseThink/" target="_blank" rel="external">Core Data, FMDB, Realm 性能测试</a>。我就多说几句</p>
<p>总觉得大家对 CoreData 误会蛮深，代码 Fork 看了一下， 总觉得不应该这样写来比性能的，但是一时半会也不知道怎么改。我只能说我在优化 CoreData 的时候根据 WWDC 上教的还是提升很高，另外一个事情是 CoreData 一般都用 Sqlite 做后端。所以如果你的查询是经过优化的，确认打出来的SQL语句科学以后，Sqlite(CoreData) 跟 Sqlite(FMDB)我觉得性能就算有差距，这差距没有能大到选择方案的决定性因素。如果使用 CoreData 遇到性能瓶颈，你应该仔细的研究 WWDC 和几篇很好的文章。确保你的 CoreData 使用方式是正确科学的。</p>
<h4 id="没有需要架构Context那种烦人的东西"><a href="#没有需要架构Context那种烦人的东西" class="headerlink" title="没有需要架构Context那种烦人的东西"></a>没有需要架构Context那种烦人的东西</h4><p>应该也算Realm简单的一个方面，Realm 只要保持自己线程里面，自己的 Realm Store 操作是正确的即可。如果是 CoreData，怎么架构一个科学的 Context Stack 就足够让我头疼一整，iOS 还好，界面是一个接着一个(VC跟VC之间的层级关系很清晰)。而 OhMyStar 2 这种 OS X 桌面应用场景VC之间很复杂，线程之间Context的关系让出现很多问题。</p>
<h4 id="支持-NSPredicate"><a href="#支持-NSPredicate" class="headerlink" title="支持 NSPredicate"></a>支持 NSPredicate</h4><p>从 CoreData 转过来并没有太多的不适应</p>
<h4 id="很简单的使用多个存储文件"><a href="#很简单的使用多个存储文件" class="headerlink" title="很简单的使用多个存储文件"></a>很简单的使用多个存储文件</h4><p>举个例子，多用户登陆情况下。用户是单独的存储文件，和全部用户使用同一个存储文件。后者需要每条用户数据都要关联一次当前用户，所有查询用户数据的时候，你都必须加上当前用户的查询项。而使用每个用户单独一个数据文件的时候，整个存储结构会清爽很多。</p>
<h4 id="技术支持"><a href="#技术支持" class="headerlink" title="技术支持"></a>技术支持</h4><p>至少实在没法的时候还可以去微博上吐槽他们，他们其实也有极大的热情来解决你遇到的问题。CoreData 这种遇到问题就只能自己默默的吞下。</p>
<h4 id="细粒化通知-更新-0-98-x-版本以后可以获得精细化通知"><a href="#细粒化通知-更新-0-98-x-版本以后可以获得精细化通知" class="headerlink" title="细粒化通知 (更新 0.98.x 版本以后可以获得精细化通知)"></a>细粒化通知 (更新 0.98.x 版本以后可以获得精细化通知)</h4><p>看最新的文档已经更新：</p>
<p><a href="https://realm.io/docs/swift/latest/#notifications" target="_blank" rel="external">Notifications</a></p>
<p>有了这个通知我思考的结构里，写入数据的所有线程都可以在后台了，而且更新UI的时候只用在需要的地方监听需要的类。这个进步</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><h4 id="关联关系弱的一逼"><a href="#关联关系弱的一逼" class="headerlink" title="关联关系弱的一逼"></a>关联关系弱的一逼</h4><p>简单说来就是对象跟对象之间的一对多关系和多对多关系。并不能映射，需要在双方里面都写上属性，此外还需要在设置的时候两边同时设置。查询时候也是 NSPredicate 也仅仅只支持一些一层的查询，没法做出带SUBQUERY的复杂查询出来。</p>
<h4 id="强制内省容错机制导致存储文件不断变大"><a href="#强制内省容错机制导致存储文件不断变大" class="headerlink" title="强制内省容错机制导致存储文件不断变大"></a>强制内省容错机制导致存储文件不断变大</h4><p>Realm本身感觉有一个数据容错机制。但是这个机制在数据库文件有错误的情况自己修复的时候，会无限增大。具体我这里表现为，打开看只有3000条数据，但是文件大小已经有3GB。重现Bug也很容易，只要你在写数据库的时候,用Realm Browser查看一下，crash之后在打开就很容易出现。</p>
<p>官方文档里面有说到会造成这种情形的原因，我在尽我所能的避免问题以后。存储文件还是会有可能不那么夸张的变大一些。但是用Realm Browser查看数据是正常的。所以我觉得官方应该提供一个函数，可以删除掉那些容易的东西。保持存储文件的干净。</p>
<h4 id="没有细粒化通知"><a href="#没有细粒化通知" class="headerlink" title="没有细粒化通知"></a>没有细粒化通知</h4><p>～～也就是说，当我在某个地方做出修改。 我其他地方只知道Realm有修改，但是没法知道我是增加、修改还是删除了数据。不知道我更新的是那一条数据。据文档说，将来会解决这个问题，就只有拭目以待。～～</p>
<h4 id="增加包体积"><a href="#增加包体积" class="headerlink" title="增加包体积"></a>增加包体积</h4><p>据官方说会增加1MB左右的包大小，如果你是一个小体积应用，或者是一个几千万用户的主流应用。对包大小敏感的话慎用。</p>
<h4 id="核心代码目前闭源"><a href="#核心代码目前闭源" class="headerlink" title="核心代码目前闭源"></a>核心代码目前闭源</h4><p>对于在我们这样一个作恶满天飞的天朝长大的孩子来说，有些孩子对闭源这个事情还是挺在意的。不过官方说将来会开源，我还是倾向于相信 Realm 他们的人品。</p>
<h2 id="CoreData"><a href="#CoreData" class="headerlink" title="CoreData"></a>CoreData</h2><p>CoreData 相关资料相对多一些我就简单说</p>
<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><h4 id="官方支持-amp-amp-亲儿子"><a href="#官方支持-amp-amp-亲儿子" class="headerlink" title="官方支持 &amp;&amp; 亲儿子"></a>官方支持 &amp;&amp; 亲儿子</h4><p>系统自带，Apple支持</p>
<h4 id="带图形化的Model编辑"><a href="#带图形化的Model编辑" class="headerlink" title="带图形化的Model编辑"></a>带图形化的Model编辑</h4><p>对于视觉化动物来说比较友好，也可以清楚的知道自己设计的 Model 之间的关系</p>
<h4 id="强大的关联关系"><a href="#强大的关联关系" class="headerlink" title="强大的关联关系"></a>强大的关联关系</h4><p>以前不觉得，用了 Realm 才发现 CoreData 的关联关系如此好用，一对多，多对多。想怎么查询就怎么查询，可以写出很复杂的查询逻辑来。</p>
<h4 id="强大的查询"><a href="#强大的查询" class="headerlink" title="强大的查询"></a>强大的查询</h4><p>虽然可能在设置NSFetchRequest的时候感觉很多东西要弄，但是复杂也带来了强大的功能，NSFetchRequest 可以设置很多，比如限制查询数量， 限制只返回某些属性值等等。就不展开说了。</p>
<h4 id="精细化的通知"><a href="#精细化的通知" class="headerlink" title="精细化的通知"></a>精细化的通知</h4><p>可以知道具体插入了什么、更新了什么、删除了什么。这样在刷UI，比如一个tableview的时候，你就可以控制的很准确。</p>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><h4 id="入门门槛高"><a href="#入门门槛高" class="headerlink" title="入门门槛高"></a>入门门槛高</h4><p>CoreData 是一个博大精深的技术，不要妄想几天之内可以用的很溜。<br>CoreData 是一个博大精深的技术，不要妄想几天之内可以用的很溜。<br>CoreData 是一个博大精深的技术，不要妄想几天之内可以用的很溜。</p>
<p>如果没有足够的时间和精力去接入 CoreData。 那选型的时候应当慎重考虑。</p>
<h4 id="需要一些工具才感觉好使"><a href="#需要一些工具才感觉好使" class="headerlink" title="需要一些工具才感觉好使"></a>需要一些工具才感觉好使</h4><p>不管是老手还是新手，使用一些第三方的封装库和工具都会大大的提高使用 CoreData 的幸福指数。</p>
<p>mogenerator 是必须必须要的。</p>
<p><a href="https://github.com/magicalpanda/MagicalRecord" target="_blank" rel="external">MagicalRecord</a> 无愧 CoreData 第一库，据小道消息 主要贡献者 Saul Mora 可能去了微信了。</p>
<h4 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h4><p>其实还是 CoreData 门槛高的问题，对我来说。Context之间的关系和线程之间的处理让我感到很头痛，特别是 OS X  是一大堆VC铺到屏幕上，我水平又菜，出的问题很多。</p>
<h4 id="多个持久化文件很麻烦"><a href="#多个持久化文件很麻烦" class="headerlink" title="多个持久化文件很麻烦"></a>多个持久化文件很麻烦</h4><p>不是说不可以，但是真的好麻烦。</p>
<p>有个第三方库有解决CoreData这个问题 <a href="https://github.com/JohnEstropia/CoreStore" target="_blank" rel="external">CoreStore</a> 但是我用着不是很顺手最后弃用.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实吧用啥持久化都行，具体还是需要看你的需求和方案上来说哪一个方案更加适合。</p>
<p>如果简单说来，就是 Realm 更加适合一些业务逻辑不怎么复杂的场景，团队配置要求不高，有经验的人稍微看一下午就能上手。</p>
<p>CoreData 更加适合业务逻辑复杂的情况，团队配置要求比较高，有经验的老手也需要几周甚至更长的时间才能科学的使用CoreData。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://iiiyu.com/2016/01/19/CoreData-VS-Realm/" data-id="cj2j30llp000lwyfywxordvje" class="article-share-link">分享</a><div class="tags"><a href="/tags/iOS/">iOS</a><a href="/tags/Mac/">Mac</a></div><div class="post-nav"><a href="/2016/01/25/Read-Wechat-Thinking-Note/" class="pre">读书笔记「微信思维」</a><a href="/2016/01/12/2016-IT-professionals-Getting-Started/" class="next">2016年移动互联网职业入门规划指南</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'iiiyu';
var disqus_identifier = '2016/01/19/CoreData-VS-Realm/';
var disqus_title = 'CoreData VS Realm （2016-02-23更新）';
var disqus_url = 'http://iiiyu.com/2016/01/19/CoreData-VS-Realm/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//iiiyu.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://iiiyu.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/read-book-notes/" style="font-size: 15px;">read book notes</a> <a href="/tags/just-talk/" style="font-size: 15px;">just-talk</a> <a href="/tags/PM/" style="font-size: 15px;">PM</a> <a href="/tags/产品汪/" style="font-size: 15px;">产品汪</a> <a href="/tags/产品思考/" style="font-size: 15px;">产品思考</a> <a href="/tags/胡思乱想/" style="font-size: 15px;">胡思乱想</a> <a href="/tags/随便瞎扯/" style="font-size: 15px;">随便瞎扯</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/Mac/" style="font-size: 15px;">Mac</a> <a href="/tags/Emacs/" style="font-size: 15px;">Emacs</a> <a href="/tags/Design/" style="font-size: 15px;">Design</a> <a href="/tags/Software/" style="font-size: 15px;">Software</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/05/10/2017-smartisan-digital-conference-view/">罗永浩的进化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/22/Be-misunderstood-of-the-miniapp/">被误解的微信小程序</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/20/2017-world-theory-of-evolution/">2017年世界进化论</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/27/2016-Social-Product-Analysis/">2016年中国社交产品分析个人报告</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/14/2016-iOS-Human-Interface-Guidelines-1/">新 iOS Human Interface Guidelines  产品解读 （一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/02/23/A-product-manager-cranky-Martial-arts-world-but-not-fast-breaking/">鱼子酱的胡思乱想 —— 天下武功唯快不破</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/25/Read-Wechat-Thinking-Note/">读书笔记「微信思维」</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/19/CoreData-VS-Realm/">CoreData VS Realm （2016-02-23更新）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/12/2016-IT-professionals-Getting-Started/">2016年移动互联网职业入门规划指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/31/read-the-tipping-point/">读书笔记 「引爆点」</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//iiiyu.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.ohmyapps.com/" title="Oh My Apps" target="_blank">Oh My Apps</a><ul></ul><a href="http://www.ohmystarapp.com/" title="Oh My Star" target="_blank">Oh My Star</a><ul></ul><a href="http://griddiaryapp.com" title="Grid Diary" target="_blank">Grid Diary</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">萧宸宇.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>